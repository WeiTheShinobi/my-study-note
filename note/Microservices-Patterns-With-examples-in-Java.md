# *《Microservices Patterns: With examples in Java》*

> 筆記：Wei the Shinobi

## 第 1 章 逃離單體地獄

應用程式不斷開發，

最終變得龐大、複雜而難以維護，

開發十分艱難。

- 一個錯誤就會導致整個程式崩壞
- 被迫使用過時的技術難以更新

### 微服務架構

- 模組化，服務之間透過 API 通信
- 每個服務有自己的私有資料庫

避免了堵塞

好處：

- 更容易地持續交付與測試
- 不同團隊的耦合被拆分
- 不同服務被隔離

壞處：

- 拆分的定義

決定哪些要拆開，做的不好可能變成**分布式的單體程式**

- 複雜

不只設計、需要更多基礎設施

- 思考何時開始**微服務架構**

初期直接從微服務架構開發非常困難

### 模式

從建築界得到的靈感，

我們可以學習特定場景的解決方案。

微服務架構的模式語言是一種模式

- 服務拆分：決定如何分解系統
  - 根據業務
  - 根據子域

- 通信：微服務架構是分布式系統，因此 IPC 是很重要的

- 數據一致性：2PC 在微服務架構之下不再適用，用 Saga 取而代之

- 查詢數據：傳統應用使用 SQL JOIN，使用 **API 組合**或**命令查詢職責隔離（CQRS）**

- 部署：相較於傳統直接複製到伺服器，你需要自動化部署

- 觀測：理解與診斷微服務很麻煩，因為請求在多個服務跳轉

  

## 第 2 章 服務的拆分策略

### 4 + 1 視圖模型

- 邏輯視圖：開發人員創建的元素
- 實現視圖：編譯系統、打包程式碼的模組，在 Java 中是 JAR 或 WAR，關係是他們之間的依賴關係
- 進程視圖：運行時的組件，每個元素都是一個進程，進程的關係代表進程間通訊
- 部屬視圖：進程如何映射到機器，元素是機器和進程，關係代表網路

4 + 1 的 1 代表場景，它把四個視圖串聯起來

架構重要的地方在於滿足了**非功能性需求**

- 微服務架構是一種風格

單體架構將應用建構為單個可執行或部屬組件

微服務架構將應用建構為鬆散耦合的一組服務

